---
import { getButtonClasses } from "@phcdevworks/spectre-ui";
import type { ButtonVariant, ButtonSize } from "@phcdevworks/spectre-ui";

type SpButtonElement = "button" | "a" | "span";

interface SpButtonProps {
  as?: SpButtonElement;
  variant?: ButtonVariant;
  size?: ButtonSize;
  fullWidth?: boolean;
  loading?: boolean;
  disabled?: boolean;
  iconOnly?: boolean;
  class?: string;

  href?: string;
  target?: "_blank" | "_self" | "_parent" | "_top";
  rel?: string;

  type?: "button" | "submit" | "reset";

  [key: string]: any;
}

const {
  as = "button",
  variant = "primary",
  size = "md",
  fullWidth = false,
  loading = false,
  disabled = false,
  iconOnly = false,
  class: className,
  href,
  ...rest
} = Astro.props as SpButtonProps;

const isDisabled = disabled || loading;

const classes = getButtonClasses({
  variant,
  size,
  fullWidth,
  loading,
  disabled: isDisabled,
  iconOnly,
});

const finalClass = [classes, className].filter(Boolean).join(" ");

// make sure rest no longer has class
delete (rest as any).class;

// If anchor is "disabled", prevent navigation and remove focus
const finalHref = as === "a" && isDisabled ? undefined : href;
const finalTabIndex = as === "a" && isDisabled ? -1 : (rest as any).tabindex;
---

{
  as === "a" ? (
    <a
      class={finalClass}
      href={finalHref}
      aria-disabled={isDisabled ? "true" : undefined}
      tabindex={finalTabIndex}
      {...rest}
    >
      <slot />
    </a>
  ) : as === "span" ? (
    <span
      class={finalClass}
      aria-disabled={isDisabled ? "true" : undefined}
      {...rest}
    >
      <slot />
    </span>
  ) : (
    <button
      class={finalClass}
      disabled={isDisabled}
      type={(rest as any).type ?? "button"}
      {...rest}
    >
      <slot />
    </button>
  )
}
