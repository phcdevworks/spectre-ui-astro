---
import type { ButtonSize, ButtonVariant } from "@phcdevworks/spectre-ui";
import { getButtonClasses } from "@phcdevworks/spectre-ui";

type SpButtonElement = "button" | "a" | "span";

interface SpButtonProps {
  as?: SpButtonElement;
  variant?: ButtonVariant;
  size?: ButtonSize;
  fullWidth?: boolean;
  loading?: boolean;
  disabled?: boolean;
  iconOnly?: boolean;
  class?: string;

  href?: string;
  target?: "_blank" | "_self" | "_parent" | "_top";
  rel?: string;

  type?: "button" | "submit" | "reset";
  [key: string]: any;
}

const {
  as = "button",
  variant = "primary",
  size = "md",
  fullWidth = false,
  loading = false,
  disabled = false,
  iconOnly = false,
  class: className,
  ...rest
} = Astro.props as SpButtonProps;

const isDisabled = disabled || loading;

const classes = getButtonClasses({
  variant,
  size,
  fullWidth,
  loading,
  disabled: isDisabled,
  iconOnly,
});

const finalClass = [classes, className].filter(Boolean).join(" ");

// remove class so it doesnâ€™t duplicate
delete (rest as any).class;

// if link is disabled/loading, prevent navigation + focus
if (as === "a" && isDisabled) {
  delete (rest as any).href;
  (rest as any).tabindex = -1;
}
---

{
  as === "a" ? (
    <a
      class={finalClass}
      aria-disabled={isDisabled ? "true" : undefined}
      {...rest}
    >
      <slot />
    </a>
  ) : as === "span" ? (
    <span
      class={finalClass}
      aria-disabled={isDisabled ? "true" : undefined}
      {...rest}
    >
      <slot />
    </span>
  ) : (
    <button
      class={finalClass}
      disabled={isDisabled}
      type={(rest as any).type ?? "button"}
      {...rest}
    >
      <slot />
    </button>
  )
}
