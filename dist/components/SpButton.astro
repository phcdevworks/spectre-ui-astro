---
import type { SpButtonProps } from "../types/button";
import { getButtonClasses } from "@phcdevworks/spectre-ui";

type Props = SpButtonProps;

const {
  variant = "primary",
  size = "md",
  as = "button",
  type = "button",
  href,
  target,
  rel,
  disabled = false,
  loading = false,
  fullWidth = false,
  class: className,
  ...rest
} = Astro.props;

const isInteractiveDisabled = disabled || loading;

// Handle success variant (map to primary in spectre-ui, then add success class)
const normalizedVariant = variant === "success" ? "primary" : variant;

const generatedClasses = getButtonClasses({
  variant: normalizedVariant,
  size,
  fullWidth,
});

// Build final class list
const classes = [
  generatedClasses,
  variant === "success" ? "sp-btn--success" : "",
  isInteractiveDisabled ? "sp-btn--disabled" : "",
  loading ? "sp-btn--loading" : "",
  className,
]
  .filter(Boolean)
  .join(" ");

const relValue = target === "_blank" ? rel || "noopener noreferrer" : rel;

const commonProps = {
  ...rest,
  class: classes,
  "aria-busy": loading || undefined,
  "data-loading": loading || undefined,
};
---

{
  as === "a" ? (
    <a
      {...commonProps}
      href={isInteractiveDisabled ? undefined : href}
      target={isInteractiveDisabled ? undefined : target}
      rel={isInteractiveDisabled ? undefined : relValue}
      aria-disabled={isInteractiveDisabled || undefined}
    >
      <slot />
    </a>
  ) : as === "span" ? (
    <span
      {...commonProps}
      role="button"
      aria-disabled={isInteractiveDisabled || undefined}
    >
      <slot />
    </span>
  ) : (
    <button {...commonProps} type={type} disabled={isInteractiveDisabled}>
      <slot />
    </button>
  )
}
